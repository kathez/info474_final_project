<!DOCTYPE html>
<html>
<head>
  <title>Mortgage</title>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
  <style type="text/css">
    label{
    display: inline-block;
    float: left;
    clear: left;
    width: 120px;
    text-align: left;
    margin-left: 1em;
    margin-right: 1em;
    margin-bottom: 1em;
    }
    input {
      display: inline-block;
      float: left;
    }

    h2, p {
      clear: both;
      margin: 14px;
    }

    button {
      clear: both;
      margin-left: 1em
    }
  </style>
</head>
<body>
  <div id="loan_calculator">
    <h2>How much loan I can get to buy a house?</h2>
    <label>Income </label><input type="text" name="income" id="income" /> 
    <label>Debt </label><input type="text" name="Debt" id="debt" />
    <label>Interest Rate </label><input type="text" name="interest_rate" id="interest_rate" />
    <label>Down Payment </label><input type="text" name="downpayment" id="downpayment" />
    <button type = "submit" onclick="loanCalculator()">Submit</button>

    <p>
      You can afford <span id="loanMax"> ? </span>
    </p>

    <p>
      Your monthly mortgage will be around <span id="monthlyMortgage"> ? </span>
    </p>

    <p> 
      After 360 months (30 years fix termed), you end up paying $ <span id="totalPayment"> ? </span>. 
    <p id="bar"></p>
  </div>

  <div id="monthly_payment">
    <h2>How much will I pay monthly as my mortgage payment?</h2>
    <label>Loan </label><input type="text" name="loan" id="loan" />
    <label>Interest Rate </label><input type="text" name="interest_rate" id="rate" />
    <button onclick="monthlyPaymentCalculator()">Submit</button>
    
    <p>
      You will pay around <span id="monthlyPayment"> ? </span>
    </p>
    </p>
  </div>

  <script type="text/javascript">
    function loanCalculator(){
      var income = Number(document.getElementById('income').value);
      var debt = Number(document.getElementById('debt').value);
      var r = Number(document.getElementById('interest_rate').value);
      var dp = Number(document.getElementById('downpayment').value);
      var i = r/12;
      var a = Math.pow(1+i,360);
      var l = (income - debt) * (a - 1)/(2 * i * a);
      var p = l + dp;
      var total = dp + (income - debt) * (a - 1)/(2 * i * a);
      var m = l * ((i * a)/(a - 1))
      var total = (m * 360).toFixed(2);
      console.log(total);
      document.getElementById('loanMax').innerHTML= "$" + p.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") + " property, with $" + l.toFixed(2) + " loan.";
      document.getElementById('monthlyMortgage').innerHTML = "$" + m.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
      document.getElementById('totalPayment').innnerHTML = "$" + total.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
      drawBarChart(l, p, total);
    }

    function drawBarChart() {
      var w = 500;
      var h = 100;
      var barPadding = 1;

      var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
                11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
      // Create SVG element 
      var svg = d3.select("#bar")
                  .append("svg")
                  .attr("width",w)
                  .attr("height",h);
      svg.selectAll("rect")
         .data(dataset)
         .enter()
         .append("rect")
         .attr("x",function(d,i) {
              return i * (w/dataset.length);
         })
         .attr("y",function(d) {
              return h - (d * 4);
         })
         .attr("width", w / dataset.length - barPadding)
         .attr("height", function(d) {
              return d * 4;
         })
         .attr("fill",function(d) {
              return "rgb(0,0," + (d*10)+")";
         });
    }

    function monthlyPaymentCalculator() {
      var l = Number(document.getElementById('loan').value);
      var r = Number(document.getElementById('rate').value);
      var i = r/12;
      var a = Math.pow(1+i,360);
      var m = l * ((i * a)/(a - 1))
      var income = m * 2;
      console.log(typeof l);
      console.log(l);
      console.log(typeof r);
      console.log(a);
      console.log(m);
      console.log(income);
      document.getElementById('monthlyPayment').innerHTML= m;
    }
  </script>
</body>
</html>